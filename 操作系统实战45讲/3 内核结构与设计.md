## 1. 内核

从抽象角度来看，**内核就是计算机资源的管理者**。

计算机资源分为硬件资源和软件资源。

硬件资源：

+ 总线：负责连接各种其它设备，是其它设备工作的基础
+ CPU
+ 内存
+ 硬盘
+ 网卡
+ 显卡
+ 各种I/O设备

## 2. 宏内核

将所有管理资源的代码进行编译，并最后链接在一起，形成一个大的可执行程序。

![宏内核结构图](宏内核结构图.md|1000)

![宏内核提供内存分配的服务过程](宏内核提供内存分配的服务过程.md|1000)

宏内核的缺点

+ 没有模版化，高度耦合在一起，一旦某个组件出错，所有组件都可能出现问题
+ 没有扩展性，开发新功能，需要重新编译、链接、安装内核
+ 没有移植性

宏内核优点

+ 性能很好

## 3. 微内核

提倡内核功能即可能少，将实际服务功能做成服务进程。

微内核功能：

+ 进程调度
+ 处理中断
+ 内存空间映射
+ 进程间通信
+ …

![微内核结构图](微内核结构图.md|1000)

![微内核提供内存分配的服务过程](微内核提供内存分配的服务过程.md|1000)

优点：

+ 系统结构清晰，利于协助开发
+ 系统拥有良好的移植性
+ 微内核代码量非常少
+ 微内核具有相当好的伸缩性、扩展性。

缺点：

+ 性能差

代表作品：

+ MACH
+ MINIX
+ L4

## 4. 分离硬件的相关性

分层的目的和主要好处在于**屏蔽底层细节，使上层开发更加简单**。

分离硬件的相关性，就是要把操作硬件和处理硬件功能差异的代码抽离出来，形成一个独立的软件抽象层，对外提供相应的接口，方便上层开发。

### 4.1. 进程调度模块的实现

进程的目的是为了实现多任务，通过不断切换进程在CPU切片运行，以实现多任务同时进行的假象。

实现的方法：

+ 进程调度：目的是从众多进程中选择一个将要运行的进程，有轮转算法、优先级算法等。
+ 进程切换：目的是停止当前进程，运行新的进程，主要动作是保存当前进程的机器上下文，装载新进程的机器上下文。

不同平台的进程调度是类似的，但进程切换方法则大不相同。

因此，只需要将进程切换的代码放在一个独立的层中实现，可以大大增强操作系统的移植性。

> 如微软推广的 HAL

## 5. 本系统的内核结构

三个大层：

+ 内核接口层
+ 内核功能层
+ 内核硬件层

![本系统内核结构](本系统内核结构.md|1000)

本操作系统内核为微内核和宏内核的混合内核架构。

### 5.1. 内核接口层

功能：定义接口

主要内容：

+ 定义了一套UNIX接口的子集
+ 编写接口代码，用于检查参数的合法性

### 5.2. 内核功能层

功能：完成各种实际功能，按照功能分模块编写。

主要模块：

+ 进程管理：实现进程的创建、销毁和调度。
+ 内存管理：内存池管理。
+ 中断管理：在相关数据结构中插入中断函数，以供发生中断时调用。
+ 设备管理：使用一系列数据结构表示驱动程序模块、驱动程序本身、驱动程序创建的设备，最后将这些数据结构组织起来，并实现设备的创建、销毁和访问。

### 5.3. 内核硬件层

功能：一个具体硬件平台相关的代码

主要内容：

+ 初始化：内核被加载到内存中最先需要运行的代码。
+ CPU 控制：提供CPU模式设定、开、关中断、读写CPU特定寄存器等功能代码
+ 中断处理：保存中断时机器的上下文，调用中断回调函数，操作中断控制器等
+ 物理内存管理：提供分配、释放大块内存，内存空间映射， 操作MMU、Cache等。
+ 平台其他相关内容
