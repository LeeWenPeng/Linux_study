## 1. linux 用户和权限

### 1.1. 2-1 root用户

root用户: 拥有最大权限的超级管理员。

普通用户: 一般在其HOME目录内是不受限的。在之外的目录中时, 普通用户往往只有只读和执行的权限。

#### 1.1.1. su

作用: 切换用户

语法:

```shell
su [-] [参数]
```

+ `[-]` 可选操作, 表示是否在切换用户后加载环境变量
	+ **切换为其他用户时，建议使用`su - username`**
+ 参数: 用户名, 省略时默认为切换到 root 用户

#### 1.1.2. `su username` 和 `su - username`

| 命令              | 说明                                                                                                                  |
| --------------- | ------------------------------------------------------------------------------------------------------------------- |
| `su username`   |  + 切换用户，但不会加载目标用户的登录环境（环境变量、路径等）。<br> + 当前 Shell 的环境部分会被保留。<br> + 启动一个非登录 Shell，不会读取目标用户的登录配置文件（如 ~/.bash_profile）。 |
| `su - username` | + 切换用户，并完全加载目标用户的登录环境（类似于目标用户刚登录系统时的环境）。<br>+ 等价于 `su --login`。<br>+ 启动登录 shell，会读取目标用户的登录配置文件。                     |

切换用户后切换回上一个用户的方法:

1. 使用`su`命令
2. 使用`exit`命令
3. 快捷键`ctrl + d`

> 普通用户切换到其他用户需要输入密码;
> root 用户切换其他用户不需要输入密码, 将直接切换

#### 1.1.3. sudo

作用: 普通用户可以通过`sudo`名命令临时使用root权限

语法:

```shell
sudo command
```

普通用户认证sudo权限

```shell
# 1 切换到root用户
su
# 2 打开/etc/sudoers文件编辑 
visudo
# 3 在文件末尾添加用户权限
用户名 ALL=(ALL) NOPASSWD:ALL
# 4 保存退出
:wq
# 切换普通用户
exit
```

### 1.2. 2-2 用户和用户组

#### 1.2.1. 基础概念

Linux关于权限的管控级别有2个粒度, 分别是:

+ 用户粒度: 针对用户的权限控制
+ 用户组粒度: 针对用户组的权限控制

Linux、用户和用户组:

1. Linux可以配置多个用户
2. Linux可以配置多个用户组
3. 用户可以加入多个用户组

> 用户和用户组的操作需要在创建删除只有 **root 用户**具有权限

#### 1.2.2. 用户组管理

1 创建用户组

```shell
groupadd 用户组名
```

2 删除用户组

```shell
groupdel 用户组名
```

#### 1.2.3. 用户管理

1 创建用户

```shell
useradd [-g -d] 用户名
```

+ `[-g]`: 指定用户组
  + 不指定`-g`, 会创建同名用户组并自动加入
  + 指定 `-g` 的前提是指定的用户组已经存在
  + 当同名用户组已经存在时, 必须指定 `-g`
+ `[-d]`: 指定用户 HOME路径
  + 不指定`-d`时, 默认在:`/HOME/用户名`

2 删除用户

```shell
userdel [-r] 用户名
```

+ `[-r]`: 删除用户时是否删除用户的HOME目录
  + 不指定`-r`时, 默认保留用户HOME目录

3 查看用户

```shell
id [用户名]
```

+ 参数: 用户名
  + 不指定参数时, 默认为查看自身

4 用户加入用户组

```shell
usermod -aH 用户组 用户名
```

#### 1.2.4. getent

1 查看系统中所有用户信息

语法:

```shell
getent passwd
```

结果中共有七份信息, 用`:`隔开, 从左到右依次是:

```shell
用户名:密码(x):用户ID:组ID:描述信息(无用):HOME目录:执行终端(默认bash)
```

2 查看系统中所有用户组信息

语法:

```shell
getent group
```

结果中共有三份信息, 用`:`隔开, 从左到右依次是:

```shell
组名:组认证(x):组ID
```

### 1.3. 2-3 查看权限认证

通过`ls -l`可以以列表的形式查看文件信息, 并显示文件权限

![[文件权限信息|1000]]

### 1.4. chmod 命令

作用: 修改文件和目录的权限

> [!note]
> 只有文件、目录的所属用户以及 root 用户才有资格使用`chmod` 命令修改文件夹的权限

语法:

```shell
chmod [-R] u=[r][w][x],g=[r][w][x],o=[r][w][x] 文件\文件夹路径
```

+ `[-R]`: 当参数2是文件夹时，如果使用 `-R` 会对文件夹以及其内部文件进行相同权限修改操作，否则只对文件夹的权限进行修改

参数：

+ `权限信息`: `u=[r][w][x],g=[r][w][x],o=[r][w][x]`
	+ `u`: user，用户
	+ `g`: group，用户组
	+ `o`: other，其他用户
	+ `[r][w][x]`: 可选，需要赋予该角色什么权限就添什么权限，比如，如果只需要赋予用户读的权限那么就只写`r`，也就是`u=r`

>[!note]
>+ 权限信息以`,`相连，中间不能有`\space`。
>+ 三者的顺序对代码不影响

除了上述以键值对的方式表示权限信息外，以２进制对应表示权限是更加快捷的写法：

```shell
# 以2进制表示更加快捷
chmod 751 test.txt
```

![[二进制表示权限|1000]]

### 1.5. chown 命令

作用：使用`chown`命令可以修改文件所属的用户以及用户组

语法：

```shell
chown [-R] [用户][:][用户组] 文件\文件夹
```

`[options]`:

+ `[-R]`: 当参数2是文件夹时，如果使用 `-R` 会对文件夹以及其内部文件进行相同权限修改操作，否则只对文件夹的权限进行修改

参数:

+ 用户: 修改所属用户
+ 用户组: 修改所属用户组
+ `:`: 用于隔开用户和用户组

> [!NOTE]
> 只允许Root用户进行操作

### 1.6. umask 命令

设置用户创建文件的默认权限。与 `chmod` 效果相反，`umask`设置的是权限的"**补码**"。

```shell
umask nnn
```

+ `nnn` ：umask设置的权限补码，范围是$[000, 777]$。

`umask` 值计算方法：

$$
\text{umask} = 777 - \text{目录权限}
$$

+ 目录权限与 `umask` 权限互为补码

$$
\text{umask} - \text{执行权限} = 666 - \text{文件权限}
$$

+ 对于文件而言，在目录创建时不能具有执行权限，因此还需要在 $777$ 的基础上减去 $111$。
